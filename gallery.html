<#
    .SYNOPSIS
    Automated Git Push and Hard Drive Mirror Script (Safe Mode)
#>

# --- CONFIGURATION (EDIT THESE) ---
$SourcePath = "C:\Users\Trinity\Desktop\accra-academy-website"
$BackupPath = "E:\MyBackups\AccraAcademy"

# --- VISUALS ---
function Print-Log ($Message, $Color) {
    Write-Host "[$((Get-Date).ToString('HH:mm:ss'))] $Message" -ForegroundColor $Color
}

Clear-Host
Print-Log "STARTING BACKUP SEQUENCE..." "Cyan"

# --- PART 1: GIT PUSH ---
Print-Log "--------------------------------" "Gray"
Print-Log "Step 1: Pushing to GitHub..." "Yellow"

if (Test-Path "$SourcePath\.git") {
    Set-Location $SourcePath
    try {
        git add .
        $timestamp = Get-Date -Format "yyyy-MM-dd HH:mm"
        git commit -m "Auto-backup: $timestamp"
        git push origin main
        Print-Log "Git Push Successful!" "Green"
    } catch {
        Print-Log "Git Error. Check internet or status." "Red"
    }
} else {
    Print-Log "Not a Git repository." "Red"
}

# --- PART 2: HARD DRIVE MIRROR ---
Print-Log "--------------------------------" "Gray"
Print-Log "Step 2: Mirroring to Hard Drive..." "Yellow"

if (!(Test-Path $BackupPath)) {
    Print-Log "Backup folder not found. Creating it..." "Cyan"
    New-Item -ItemType Directory -Force -Path $BackupPath | Out-Null
}

$ExcludeDirs = @("node_modules", ".git", "server\node_modules")

# Execute Robocopy
robocopy $SourcePath $BackupPath /MIR /XO /FFT /R:3 /W:5 /XD $ExcludeDirs /NJH /NJS /NDL /NC /NS

if ($LASTEXITCODE -lt 8) {
    Print-Log "Hard Drive Backup Synced." "Green"
} else {
    Print-Log "Robocopy encountered errors." "Red"
}

Print-Log "--------------------------------" "Gray"
Print-Log "MISSION COMPLETE." "Cyan"
Read-Host "Press Enter to exit"